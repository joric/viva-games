<!DOCTYPE html>
<html lang="en">
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Joric's Viva Games</title>
  <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
  <style>
    body {
        padding: 0;
        margin: 0;
    }
    html, body, #map {
        height: 100%;
        width: 100%;
        background: black;
        image-rendering: pixelated;
    }
  </style>
</head>
<body>
<div id="map"></div>
<script>

let w = h = 32768;
let tileSize = 512;
let factor = tileSize / w;
let bounds = [[0,0], [w, h]];

L.CRS.myCRS = L.extend({}, L.CRS.Simple, {
  transformation: new L.Transformation(factor, 0, factor, 0),
});

let map = L.map('map', {
  crs: L.CRS.myCRS,
}).setView([w/2,h/2],0).setMaxBounds(bounds);

L.tileLayer('tiles/{z}/{x}/{y}.jpg', {
  minZoom: 1,
  // maxZoom: 6,
  maxNativeZoom: 6,
  tileSize: tileSize,
  bounds: bounds,
  attribution: '<a href="https://github.com/joric/viva-games" target="_blank">Joric\'s Viva Games</a>',
}).addTo(map);

var x, y;

function getTileNumber(x,y) {
  // Image: 19456 x 11040 pixels, 152x116 tiles, each tile 128x95 pixels, 17632 tiles total
  let pw = 19456;
  let ph = 11040;
  let tw = 128;
  let th = 95;

  let left = (w - pw)/2;
  let top = (h - ph)/2;
  let right = left + pw;
  let bottom = top + ph;

  if (x>=left && x<right && y>=top && y<bottom) {
    x -= left;
    y -= top;
    tx = Math.floor(x / tw);
    ty = Math.floor(y / th);
    return tx + Math.floor(pw / tw) * ty;
  }

  return -1
}

map.on('mousemove', function(e) {
  let t = getTileNumber(e.latlng.lng, e.latlng.lat);
  document.getElementById('map').title = t>=0 ? 'game ' + t : '';
});

map.on('click', function(e) {
  let t = getTileNumber(e.latlng.lng, e.latlng.lat);
  if (t>=0) {
    alert('you clicked game ' + t);
  }
});

</script>
</body>
</html>
